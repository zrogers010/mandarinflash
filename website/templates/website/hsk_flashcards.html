
{% extends 'base.html' %}

{% load static %}

{% block css_files %}
    <link rel="stylesheet" href="{% static "website/style.css" %}" />
    <link rel="stylesheet" href="{% static "website/flashcards.css" %}" />
{% endblock %}

{% block head %}
    {{ block.super }}
    {% load django_bootstrap5 %}
    {% bootstrap_css %}
    {% bootstrap_javascript %}
{% endblock %}

{% block 'content' %}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <script>
        $(document).ready(function() {
            var correctGuesses = 0;
            var totalGuesses = 0;
            var guessMade = false;
        
            function updateScoreDisplay() {
                $("#score-display").text("Score: " + correctGuesses + "/" + totalGuesses);
            }
        
            $(".answer-btn").click(function() {
                
                var itemId = $(this).data("item-id");
                // var itemAnswer = $("#word-answer-" + itemId).val();
                var itemAnswer = $(this).closest('.carousel-item').find('.card-title').text();
                console.log("ItemAnswer: ", itemAnswer);
                var guess = $(this).val();
                console.log("Guess: ", guess)
                var label = $(this).closest('li').find('label');
                
                if (guessMade) {
                    if (guess == itemAnswer) {
                        label.removeClass("btn-outline-danger").addClass("btn-outline-success");
                        return;
                    } else {
                        label.removeClass("btn-outline-danger").addClass("btn-outline-danger");
                        return;
                    }
                }
                guessMade = true;

                if (guess == itemAnswer) {
                    console.log("TRUE!!!!!")
                    label.removeClass("btn-outline-danger").addClass("btn-outline-success");
                    correctGuesses++;
                    totalGuesses++;
                } else {
                    label.removeClass("btn-outline-danger").addClass("btn-outline-danger");
                    totalGuesses++;
                }
                updateScoreDisplay();
            });

            $("#wordCarousel").on("slid.bs.carousel", function() {
                guessMade = false;
            });
        });
    </script>

    <div class="container">
        <div class="page-header">
            {% if level == 1 or level == 2 %}
                <h2>Beginner Level {{ level }} Flashcard Quiz</h2>
            {% elif level == 3 or level == 4 %}
                <h2>Intermediate Level {{ level }} Flashcard Quiz</h2>
            {% else %}
                <h2>Advanced Level {{ level }} Flashcard Quiz</h2>
            {% endif %}
            <a href="/words/{{level}}"><h5>Level {{ level }} Vocabulary Words</h5></a>
        </div>

        {% comment %} 
        <div class="container">
            <div class="row justify-content-center mb-3">
                <div class="col-auto">
                    <form id="wordCountForm">
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="wordCount" id="wordCount20" value="25" checked>
                            <label class="form-check-label" for="wordCount20">25</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="wordCount" id="wordCount50" value="50">
                            <label class="form-check-label" for="wordCount50">50</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="wordCount" id="wordCount100" value="100">
                            <label class="form-check-label" for="wordCount100">100</label>
                        </div>
                    </form>
                </div>
            </div>
        </div> 
        {% endcomment %}

        <div id="wordCarousel" class="carousel carousel-dark slide border" data-bs-ride="carousel">
            <div class="carousel-inner">
                {% for word in words %}
                    <div class="carousel-item {% if forloop.first %}active{% endif %}">
                        <div class="card">
                            <input type="checkbox" id="card-flipper-{{ forloop.counter }}" class="card-flipper invisible">
                            <div class="card-inner">
                                <div class="card-front shadow">
                                    <div class="card-body">
                                        <span>
                                            <h1 class="card-title text-danger">{{ word.unicode|safe }}</h1>
                                        </span>
                                        {% comment %} <button class="btn btn-outline-secondary btn-sm" type="button">&#x1F50A;</button> {% endcomment %}
                                        <button class="btn btn-outline-secondary btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#card-text-{{ forloop.counter }}" aria-expanded="false" aria-controls="card-text-{{ forloop.counter }}">
                                            Show Pīnyīn
                                        </button>
                                        <div class="collapse" id="card-text-{{ forloop.counter }}">
                                            <p class="card-text pinyin">{{ word.pinyin1 }}</p>
                                        </div>
                                        <label for="card-flipper-{{ forloop.counter }}" class="btn btn-primary btn-sm">Flip</label>                                        
                                    </div>
                                </div>
                                <div class="card-back shadow">
                                    <div class="card-body">                                 
                                        <div>
                                            <h2 class="card-text" style="display: inline"><a href="/character/{{ word.unicode|safe }}"> {{ word.unicode|safe }} </a></h2>
                                            <h4 style="display: inline"> {{ word.pinyin1 }} </h4>
                                            <p style="display: inline"> {{ word.partofspeech }} </p>
                                        </div>
                                        <hr>                                   
                                        <p class="card-text"><strong>{{ word.english1|capfirst }}</strong></p>
                                        <hr>
                                        <table class="table table-sm">
                                            <tr>
                                                <td><strong>{{ word.s1_char }}</strong></td>
                                            <tr>
                                            </tr>
                                                <td>{{ word.s1_pinyin}}</td>
                                            <tr>
                                            </tr>
                                                <td>{{ word.s1_english}}</td>
                                            </tr>
                                        </table>
                                        <label for="card-flipper-{{ forloop.counter }}" class="btn btn-primary flip-back">Flip Back</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class=" {% if forloop.first %}active{% endif %}" id="answer-buttons">

                            <strong><p>Pick the character's matching definition</p></strong>

                            <ol>
                                <li>
                                    <input type="radio" class="btn-check answer-btn" name="flashcard-answers-{{ forloop.counter }}" id="answer-1-{{ forloop.counter }}" data-item-id="{{ forloop.counter }}" value="{{ word.answer1.0}}" autocomplete="off">
                                    <label class="btn btn-outline-secondary" for="answer-1-{{ forloop.counter }}">{{ word.answer1.1 }}</label>
                                    <input type="hidden" id="word-answer-{{ forloop.counter }}" value="{{ word.answer1.0 }}">
                                </li>
                                <li>
                                    <input type="radio" class="btn-check answer-btn" name="flashcard-answers-{{ forloop.counter }}" id="answer-2-{{ forloop.counter }}" data-item-id="{{ forloop.counter }}" value="{{ word.answer2.0 }}" autocomplete="off">
                                    <label class="btn btn-outline-secondary" for="answer-2-{{ forloop.counter }}">{{ word.answer2.1 }}</label>
                                    <input type="hidden" id="word-answer-{{ forloop.counter }}" value="{{ word.answer2.0 }}">
                                </li>
                                <li>
                                    <input type="radio" class="btn-check answer-btn" name="flashcard-answers-{{ forloop.counter }}" id="answer-3-{{ forloop.counter }}" data-item-id="{{ forloop.counter }}" value="{{ word.answer3.0 }}" autocomplete="off">
                                    <label class="btn btn-outline-secondary" for="answer-3-{{ forloop.counter }}">{{ word.answer3.1 }}</label>
                                    <input type="hidden" id="word-answer-{{ forloop.counter }}" value="{{ word.answer3.0 }}">
                                </li>
                                <li>
                                    <input type="radio" class="btn-check answer-btn" name="flashcard-answers-{{ forloop.counter }}" id="answer-4-{{ forloop.counter }}" data-item-id="{{ forloop.counter }}" value="{{ word.answer4.0 }}" autocomplete="off">
                                    <label class="btn btn-outline-secondary" for="answer-4-{{ forloop.counter }}">{{ word.answer4.1 }}</label>
                                    <input type="hidden" id="word-answer-{{ forloop.counter }}" value="{{ word.answer4.0 }}">
                                </li>
                            </ol>
                        </div>
                    </div>
                {% endfor %}
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#wordCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="text-primary"><strong>Last</strong></span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#wordCarousel" data-bs-slide="next">
                <span class="text-primary"><strong>Next</strong></span>
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
            </button>
        </div>
        <strong><div id="score-display">Score:  {{ correctGuesses }}/{{ totalGuesses }}</div></strong>

    </div>


{% endblock %}












